modules:
  default:
    lmod:
      core_compilers:
      - 'gcc@11.4.0'  # bootstrap version (entry point)
      exclude:
      - '%gcc@11.4.0' # exclude packages from bootstrap
      - 'lmod'
      include:        # user-facing compilers
      - gcc
      - llvm
      - mpi
      hierarchy:
      - mpi
      all:
        filter:
          exclude_env_vars:
          - "C_INCLUDE_PATH"
          - "CPLUS_INCLUDE_PATH"
          - "LIBRARY_PATH"
        environment:
          set:
            '{name}_ROOT': '{prefix}'
      exclude_implicits: True
      hash_length: 0
      projections:
        all: '{name}/{version}'
        ^lapack: '{name}/{version}-{^lapack.name}'

      defaults:
      - gcc@12.1.0

      openmpi:
        environment:
          set:
            SLURM_MPI_TYPE: pmi2

      gurobi:
        environment:
          set:
            GRB_LICENSE_FILE: /opt/gurobi/gurobi.lic

      ^intel-oneapi-mkl:
        environment:
          prepend_path:
            LD_LIBRARY_PATH: '{^intel-oneapi-mkl.prefix}/compiler/2023.1.0/linux/compiler/lib/intel64_lin'

      apptainer:
        environment:
          prepend_path:
            PATH: "/opt/public/apptainer"

      z3:
        environment:
          set:
            Z3_LIBRARY_PATH: "{prefix.lib}"

      tapa:
        environment:
          prepend_path:
            LD_LIBRARY_PATH: '{prefix.lib}'
